#include <REGX52.H>
#include "another.h"
#include "Timer.h"

sbit Beep = P1^5;

unsigned FreqTable[] = {0,63775,63874,63967,64055,64138,64217,64291,64360,
	64426,64489,64548,64603,64655,64705,64751,64795,64837,64876,64913,64948,
	64981,65012,65042,65069,65096,65120,65144,65166,65187,65206,65225,65242,
	65259,65274,65289,65303};

unsigned char code Music[] = {
	0,4,
	0,4,
	0,4,
	22,2,
	24,2,
	
	25,6,
	24,2,
	25,4,
	29,4,
	
	24,12,
	17,2,
	17,2,
	
	22,6,
	20,2,
	22,4,
	25,4,
	
	20,12,
	17,4,
	
	18,6,
	17,2,
	18,4,
	25,4,
	
	17,8,
	0,2,
	25,2,
	25,2,
	25,2,
	
	24,6,
	19,2,
	19,4,
	24,4,
	
	24,8,
	0,4,
	22,2,
	24,2,
	
	25,6,
	24,2,
	25,4,
	29,4,
	
	24,12,
	17,2,
	17,2,
	
	22,6,
	20,2,
	22,4,
	25,4,
	
	20,12,
	15,2,
	17,2,
	
	18,4,
	25,2,
	24,4,
	25,4,
	
	27,2,
	27,2,
	29,2,
	25,10,
	
	25,2,
	24,2,
	22,2,
	22,2,
	24,4,
	21,4,
	
	22,12,
	25,2,
	27,2,
	
	29,6,
	27,2,
	29,4,
	32,4,
	
	27,12,
	20,2,
	20,2,
	
	25,6,
	24,2,
	25,4,
	29,4,
	
	29,16,
	
	22,2,
	24,2,
	25,4,
	24,4,
	27,2,
	27,2,
	
	25,6,
	20,10,
	
	30,4,
	29,4,
	27,4,
	25,4,
	
	29,12,
	29,4,
	
	34,8,
	32,4,
	32,4,
	
	29,2,
	27,2,
	25,8,
	0,2,
	25,2,
	
	27,4,
	25,2,
	27,2,
	27,4,
	32,4,
	
	29,12,
	29,4,
	
	34,8,
	32,8,
	
	29,2,
	27,2,
	25,8,
	0,2,
	25,2,
	
	27,4,
	25,2,
	27,6,
	24,4,
	
	22,12,
		
	0xFF};

unsigned char num1,num2 = 1;
	
void main()
{
	Timer0_Init();
	while(1)
	{
		if(Music[num1] != 0xFF)
		{
			Delay(125 * Music[num2]);
			num1 += 2;
			num2 += 2;
			TR0 = 0;    //两个音之间的间隔
			Delay(10);
			TR0 = 1;
		}
		else
		{
			TR0 = 0;
			while(1);
		}
	}
}

void Timer0_Routine() interrupt 1
{
	if(FreqTable[Music[num1]])
	{
		TL0 = FreqTable[Music[num1]] % 256;
		TH0 = FreqTable[Music[num1]] / 256;
		Beep = !Beep;
	}
}